<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" href="/favicon.ico">

  <title>
    第一章：应用程序与基本执行环境 · rCore 2024S 随记 - 255DoesNotExist
  </title>

  <meta name="description" content="OSComp 2024 随记 · 一" /><meta name="generator" content="Hugo 0.124.1">

  <link rel="stylesheet" href="//localhost:1313/css/main.css" />

  
  

  <meta property="og:title" content="第一章：应用程序与基本执行环境 · rCore 2024S 随记" />
<meta property="og:description" content="OSComp 2024 随记 · 一" />
<meta property="og:type" content="article" />
<meta property="og:url" content="//localhost:1313/articles/rcore_2024s_1/" /><meta property="og:image" content="//localhost:1313/digital-garden-logo.png" /><meta property="article:section" content="articles" />
<meta property="article:published_time" content="2024-04-19T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-04-19T00:00:00+00:00" />


  <meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="//localhost:1313/digital-garden-logo.png" /><meta name="twitter:title" content="第一章：应用程序与基本执行环境 · rCore 2024S 随记"/>
<meta name="twitter:description" content="OSComp 2024 随记 · 一"/>


  <meta itemprop="name" content="第一章：应用程序与基本执行环境 · rCore 2024S 随记">
<meta itemprop="description" content="OSComp 2024 随记 · 一"><meta itemprop="datePublished" content="2024-04-19T00:00:00+00:00" />
<meta itemprop="dateModified" content="2024-04-19T00:00:00+00:00" />
<meta itemprop="wordCount" content="851"><meta itemprop="image" content="//localhost:1313/digital-garden-logo.png" />
<meta itemprop="keywords" content="" />

  <meta itemprop="name" content="第一章：应用程序与基本执行环境 · rCore 2024S 随记">
<meta itemprop="description" content="OSComp 2024 随记 · 一"><meta itemprop="datePublished" content="2024-04-19T00:00:00+00:00" />
<meta itemprop="dateModified" content="2024-04-19T00:00:00+00:00" />
<meta itemprop="wordCount" content="851"><meta itemprop="image" content="//localhost:1313/digital-garden-logo.png" />
<meta itemprop="keywords" content="" />
</head><body class="flex relative h-full min-h-screen"><aside
  class="will-change-transform transform transition-transform -translate-x-full absolute top-0 left-0 md:relative md:translate-x-0 w-3/4 md:basis-60 h-full min-h-screen p-3 bg-slate-50 dark:bg-slate-800 border-r border-slate-200 dark:border-slate-700 flex flex-col gap-2.5 z-20 sidebar flex-shrink-0">
  <p class="font-bold mb-5 flex items-center gap-2">
    <button aria-label="Close sidebar"
      class="md:hidden menu-trigger-close p-1 rounded text-slate-800 dark:text-slate-50 hover:bg-slate-200 dark:hover:bg-slate-700"><svg class="h-6 w-6" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
  fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" />
  <line x1="18" y1="6" x2="6" y2="18" />
  <line x1="6" y1="6" x2="18" y2="18" />
</svg></button>
    <a href="//localhost:1313/" class="px-2">
      <span>255DoesNotExist</span>
    </a>
    <button aria-label="Toggle dark mode"
      class="dark-mode-toggle p-2 rounded border dark:border-slate-700 hover:bg-slate-200 dark:hover:bg-slate-700"><svg class="h-4 w-4" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
  fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" />
  <circle cx="12" cy="12" r="4" />
  <path d="M3 12h1M12 3v1M20 12h1M12 20v1M5.6 5.6l.7 .7M18.4 5.6l-.7 .7M17.7 17.7l.7 .7M6.3 17.7l-.7 .7" />
</svg></button>
  </p>

  
  <ul class="list-none flex flex-col gap-1">
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/" >
        <span>Home</span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  text-slate-400 font-semibold pb-0 pl-1 border-b cursor-default pointer-events-none "
        href="#" >
        <span>Content</span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/articles" >
        <span>Articles</span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/stack" >
        <span>Stack</span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  text-slate-400 font-semibold pb-0 pl-1 border-b cursor-default pointer-events-none "
        href="#" >
        <span>Links</span>
        
      </a>
    </li>
    
  </ul>

  <div class="flex-1"></div>

  <div class="newsletter-widget">
  <div class="text-bold text-sm">Subscribe to my newsletter</div>
  
  <p class="text-xs my-1 text-slate-500">A curated weekly digest once a week to your mailbox</p>
  

  
  
  
  

  

  <form action="https://buttondown.email/api/emails/embed-subscribe/" method="post" id="newsletter_form" name="" target="_blank">
    <div class="mt-2">
      <input type="email" class="w-full px-1.5 py-0.5 text-sm rounded border dark:border-slate-700 dark:bg-slate-600" name="email" id="member_email" placeholder="Your email address...">
      <input type="submit" class="mt-2 w-full text-center text-sm bg-slate-800 text-white dark:bg-slate-50 dark:text-slate-800 py-1 rounded cursor-pointer" name="subscribe" id="member_submit" value="Subscribe">
    </div>
  </form>

  
</div>

  <ul class="list-none flex flex-wrap justify-center gap-1 pt-2 border-t border-slate-200 dark:border-slate-600">
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm block text-slate-800 dark:text-slate-50  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="https://twitter.com" target="_blank" rel="noopener noreferrer">
        <span class="sr-only">Twitter</span>
        
        <span><svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
  stroke-linecap="round" stroke-linejoin="round">
  <path
    d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z" />
</svg></span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm block text-slate-800 dark:text-slate-50  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="https://github.com" target="_blank" rel="noopener noreferrer">
        <span class="sr-only">GitHub</span>
        
        <span><svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
  stroke-linecap="round" stroke-linejoin="round">
  <path
    d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" />
</svg></span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm block text-slate-800 dark:text-slate-50  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="https://linkedin.com" target="_blank" rel="noopener noreferrer">
        <span class="sr-only">LinkedIn</span>
        
        <span><svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
  stroke-linecap="round" stroke-linejoin="round">
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z" />
  <rect x="2" y="9" width="4" height="12" />
  <circle cx="4" cy="4" r="2" />
</svg></span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm block text-slate-800 dark:text-slate-50  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="https://instagram.com" target="_blank" rel="noopener noreferrer">
        <span class="sr-only">Instagram</span>
        
        <span><svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
  stroke-linecap="round" stroke-linejoin="round">
  <rect x="2" y="2" width="20" height="20" rx="5" ry="5" />
  <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z" />
  <line x1="17.5" y1="6.5" x2="17.51" y2="6.5" />
</svg></span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm block text-slate-800 dark:text-slate-50  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="https://dribbble.com" target="_blank" rel="noopener noreferrer">
        <span class="sr-only">Dribbble</span>
        
        <span><svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
  stroke-linecap="round" stroke-linejoin="round">
  <circle cx="12" cy="12" r="10" />
  <path
    d="M8.56 2.75c4.37 6.03 6.02 9.42 8.03 17.72m2.54-15.38c-3.72 4.35-8.94 5.66-16.88 5.85m19.5 1.9c-3.5-.93-6.63-.82-8.94 0-2.58.92-5.01 2.86-7.44 6.32" />
</svg></span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm block text-slate-800 dark:text-slate-50  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="https://codepen.io" target="_blank" rel="noopener noreferrer">
        <span class="sr-only">Codepen</span>
        
        <span><svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
  stroke-linecap="round" stroke-linejoin="round">
  <polygon points="12 2 22 8.5 22 15.5 12 22 2 15.5 2 8.5 12 2" />
  <line x1="12" y1="22" x2="12" y2="15.5" />
  <polyline points="22 8.5 12 15.5 2 8.5" />
  <polyline points="2 15.5 12 8.5 22 15.5" />
  <line x1="12" y1="2" x2="12" y2="8.5" />
</svg></span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm block text-slate-800 dark:text-slate-50  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="https://twitch.com" target="_blank" rel="noopener noreferrer">
        <span class="sr-only">Twitch</span>
        
        <span><svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
  stroke-linecap="round" stroke-linejoin="round">
  <path d="M21 2H3v16h5v4l4-4h5l4-4V2zM11 11V7M16 11V7" />
</svg></span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm block text-slate-800 dark:text-slate-50  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="mailto:user@example.org" target="_blank" rel="noopener noreferrer">
        <span class="sr-only">Email</span>
        
        <span><svg class="h-4 w-4" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
  fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" />
  <rect x="3" y="5" width="18" height="14" rx="2" />
  <polyline points="3 7 12 13 21 7" />
</svg></span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm block text-slate-800 dark:text-slate-50  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/articles/index.xml" target="_blank" rel="noopener noreferrer">
        <span class="sr-only">RSS</span>
        
        <span><svg class="h-4 w-4" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
  fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" />
  <circle cx="5" cy="19" r="1" />
  <path d="M4 4a16 16 0 0 1 16 16" />
  <path d="M4 11a9 9 0 0 1 9 9" />
</svg></span>
        
      </a>
    </li>
    
  </ul>
</aside>

<div
  class="fixed bg-slate-700 bg-opacity-5 transition duration-200 ease-in-out inset-0 z-10 pointer-events-auto md:hidden left-0 top-0 w-full h-full hidden menu-overlay">
</div>

<button aria-label="Toggle Sidebar"
  class="md:hidden absolute top-3 left-3 z-10 menu-trigger p-1 rounded text-slate-800 dark:text-slate-50 hover:bg-slate-100"><svg class="h-6 w-6" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
  fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" />
  <line x1="4" y1="6" x2="20" y2="6" />
  <line x1="4" y1="12" x2="20" y2="12" />
  <line x1="4" y1="18" x2="16" y2="18" />
</svg></button>






<div class="flex flex-1 h-screen relative w-full min-w-0">

  <section
    class="will-change-transform transform transition-transform -translate-x-[200%] absolute top-0 left-0 lg:relative
  lg:translate-x-0 lg:basis-[400px] h-full bg-slate-50 dark:bg-slate-800 border-r border-slate-200 dark:border-slate-700 lg:flex flex-col py-3 overflow-y-auto scroll-area flex-shrink-0">
    
    
    <a href="//localhost:1313/articles/">
      <h2 class="font-bold mb-5 py-1 pl-12 pr-3 md:px-3">Articles</h2>
    </a>
<label class="mb-2 block px-2">
  <span></span>
  <input type="text" placeholder="Search articles" class="searchInput bg-white rounded px-2 py-1 w-full border" />
</label>
<script>
  const searchElt = document.querySelector('.searchInput')
  if (searchElt) {
    searchElt.addEventListener('input', evt => {
      const value = evt.target.value || '';

      const articles = document.querySelectorAll('.article')
      if (!value) {
        articles.forEach(article => article.classList.remove('hidden'))
      } else {
        articles.forEach(article => article.classList.add('hidden'))
        Array.from(articles).filter(article => {
          const title = article.querySelector('h3')
          if (!title) return false;

          return title.textContent.toLowerCase().includes(value.toLowerCase())
        }).forEach(article => article.classList.remove('hidden'))
      }
    })
  }
</script>
<div class="space-y-2.5">
      
      <a class="article block px-3 py-4  bg-slate-900 dark:bg-slate-700 text-slate-50 "
        href="/articles/rcore_2024s_1/">
        
        
        <h3 class="text-lg font-semibold mb-0.5">第一章：应用程序与基本执行环境 · rCore 2024S 随记</h3>
        <div
          class="text-sm  text-slate-400  line-clamp-2">
          前言 实际实践参考的文档：rCore Tutorial Guide 2024S。
拥有更为详细细节介绍的 rCore OS 官方文档：rCore-Tutorial-Book-v3。
第一章：应用程序与基本执行环境 引言 本章预期代码树：
├── bootloader (内核依赖的运行在 M 特权级的 SBI 实现，本项目中我们使用 RustSBI) │ └── rustsbi-qemu.bin ├── os │ ├── Cargo.toml (cargo 项目配置文件) │ ├── Makefile │ └── src │ ├── console.rs (将打印字符的 SBI 接口进一步封装实现更加强大的格式化输出) │ ├── entry.asm (设置内核执行环境的的一段汇编代码) │ ├── lang_items.rs (需要我们提供给 Rust 编译器的一些语义项，目前包含内核 panic 时的处理逻辑) │ ├── linker.ld (控制内核内存布局的链接脚本以使内核运行在 qemu 虚拟机上) │ ├── logging.rs (为本项目实现了日志功能) │ ├── main.rs (内核主函数) │ └── sbi.
        </div>
      </a>
      
      <a class="article block px-3 py-4  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/articles/rcore_2024s_0/">
        
        
        <h3 class="text-lg font-semibold mb-0.5">第零章：实验环境配置 · rCore 2024S 随记</h3>
        <div
          class="text-sm  text-slate-500 dark:text-slate-400  line-clamp-2">
          前言 实际实践参考的文档：rCore Tutorial Guide 2024S。
拥有更为详细细节介绍的 rCore OS 官方文档：rCore-Tutorial-Book-v3。
第零章：实验环境配置 OS 环境配置 OS环境 Ubuntu Server 22.04 amd64。
Rust 开发环境配置 通过 rustup 安装的当前最新版工具链。
curl https://sh.rustup.rs -sSf | sh Qemu 模拟器安装 参考文档，从源码安装 Qemu 7.0.0。
sudo apt install autoconf automake autotools-dev curl libmpc-dev libmpfr-dev libgmp-dev \ gawk build-essential bison flex texinfo gperf libtool patchutils bc \ zlib1g-dev libexpat-dev pkg-config libglib2.0-dev libpixman-1-dev git tmux python3 wget https://download.qemu.org/qemu-7.0.0.tar.xz # 解压 tar xvJf qemu-7.0.0.tar.xz # 编译安装并配置 RISC-V 支持 cd qemu-7.
        </div>
      </a>
      
      <a class="article block px-3 py-4  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/articles/hello/">
        
        
        <h3 class="text-lg font-semibold mb-0.5">Hello</h3>
        <div
          class="text-sm  text-slate-500 dark:text-slate-400  line-clamp-2">
          Hello.
        </div>
      </a>
      </div>
    </section>

  <div class="overflow-y-auto h-screen w-full">
    <article class="px-6 py-20 w-full mx-auto prose lg:prose-lg h-fit dark:prose-invert prose-img:mx-auto">

      
      <h1 class="!mb-2">第一章：应用程序与基本执行环境 · rCore 2024S 随记</h1>

	  
      <p class="text-sm text-slate-500 !mb-8"> Planted April 19, 2024
		
	  </p>
      

      

      <h1 id="前言">前言</h1>
<p>实际实践参考的文档：<a href="https://learningos.cn/rCore-Tutorial-Guide-2024S/"  target="_blank" rel="noopener" >rCore Tutorial Guide 2024S</a>。</p>
<p>拥有更为详细细节介绍的 rCore OS 官方文档：<a href="https://rcore-os.cn/rCore-Tutorial-Book-v3/chapter0/0intro.html"  target="_blank" rel="noopener" >rCore-Tutorial-Book-v3</a>。</p>
<h1 id="第一章应用程序与基本执行环境">第一章：应用程序与基本执行环境</h1>
<h2 id="引言">引言</h2>
<p>本章预期代码树：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>├── bootloader <span style="color:#ff79c6">(</span>内核依赖的运行在 M 特权级的 SBI 实现，本项目中我们使用 RustSBI<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>│   └── rustsbi-qemu.bin
</span></span><span style="display:flex;"><span>├── os
</span></span><span style="display:flex;"><span>│   ├── Cargo.toml <span style="color:#ff79c6">(</span>cargo 项目配置文件<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>│   ├── Makefile
</span></span><span style="display:flex;"><span>│   └── src
</span></span><span style="display:flex;"><span>│       ├── console.rs <span style="color:#ff79c6">(</span>将打印字符的 SBI 接口进一步封装实现更加强大的格式化输出<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>│       ├── entry.asm <span style="color:#ff79c6">(</span>设置内核执行环境的的一段汇编代码<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>│       ├── lang_items.rs <span style="color:#ff79c6">(</span>需要我们提供给 Rust 编译器的一些语义项，目前包含内核 panic 时的处理逻辑<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>│       ├── linker.ld <span style="color:#ff79c6">(</span>控制内核内存布局的链接脚本以使内核运行在 qemu 虚拟机上<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>│       ├── logging.rs <span style="color:#ff79c6">(</span>为本项目实现了日志功能<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>│       ├── main.rs <span style="color:#ff79c6">(</span>内核主函数<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>│       └── sbi.rs <span style="color:#ff79c6">(</span>封装底层 SBI 实现提供的 SBI 接口<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>└── rust-toolchain <span style="color:#ff79c6">(</span>整个项目的工具链版本<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cloc os
</span></span><span style="display:flex;"><span>-------------------------------------------------------------------------------
</span></span><span style="display:flex;"><span>Language                     files          blank        comment           code
</span></span><span style="display:flex;"><span>-------------------------------------------------------------------------------
</span></span><span style="display:flex;"><span>Rust                             <span style="color:#bd93f9">5</span>             <span style="color:#bd93f9">25</span>              <span style="color:#bd93f9">6</span>            <span style="color:#bd93f9">155</span>
</span></span><span style="display:flex;"><span>make                             <span style="color:#bd93f9">1</span>             <span style="color:#bd93f9">11</span>              <span style="color:#bd93f9">4</span>             <span style="color:#bd93f9">34</span>
</span></span><span style="display:flex;"><span>Assembly                         <span style="color:#bd93f9">1</span>              <span style="color:#bd93f9">1</span>              <span style="color:#bd93f9">0</span>             <span style="color:#bd93f9">11</span>
</span></span><span style="display:flex;"><span>TOML                             <span style="color:#bd93f9">1</span>              <span style="color:#bd93f9">2</span>              <span style="color:#bd93f9">1</span>              <span style="color:#bd93f9">7</span>
</span></span><span style="display:flex;"><span>-------------------------------------------------------------------------------
</span></span><span style="display:flex;"><span>SUM:                             <span style="color:#bd93f9">8</span>             <span style="color:#bd93f9">39</span>             <span style="color:#bd93f9">11</span>            <span style="color:#bd93f9">207</span>
</span></span><span style="display:flex;"><span>-------------------------------------------------------------------------------
</span></span></code></pre></div><h2 id="应用程序执行环境与平台支持">应用程序执行环境与平台支持</h2>
<h3 id="执行应用程序">执行应用程序</h3>
<p>按文档要求，我们切回主分支 main。执行命令。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cargo new os
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ tree
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>├── os
</span></span><span style="display:flex;"><span>│   ├── Cargo.lock
</span></span><span style="display:flex;"><span>│   ├── Cargo.toml
</span></span><span style="display:flex;"><span>│   └── src
</span></span><span style="display:flex;"><span>│       └── main.rs
</span></span><span style="display:flex;"><span>└── README.md
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">3</span> directories, <span style="color:#bd93f9">4</span> files
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#8be9fd;font-style:italic">cd</span> os/
</span></span><span style="display:flex;"><span>$ cargo run
</span></span><span style="display:flex;"><span>   Compiling os v0.1.0 <span style="color:#ff79c6">(</span>/home/ezra/rCore-Tutorial-Code-2024S/os<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    Finished dev <span style="color:#ff79c6">[</span>unoptimized + debuginfo<span style="color:#ff79c6">]</span> target<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span> in 0.32s
</span></span><span style="display:flex;"><span>     Running <span style="color:#f1fa8c">`</span>target/debug/os<span style="color:#f1fa8c">`</span>
</span></span><span style="display:flex;"><span>Hello, world!
</span></span></code></pre></div><blockquote>
<p>我们在屏幕上看到了一行 Hello, world! ，但为了打印出 Hello, world!，我们需要的不止几行源代码。</p>
</blockquote>
<h3 id="理解应用程序执行环境">理解应用程序执行环境</h3>
<p><img src="https://learningos.cn/rCore-Tutorial-Guide-2024S/_images/app-software-stack.png" alt=""></p>
<blockquote>
<p>我们的应用程序通过调用标准库或第三方库提供的接口，仅需少量源代码就能完成复杂的功能； Hello, world! 程序调用的 println! 宏就是由 Rust 标准库 std 和 GNU Libc 等提供的。 这些库属于应用程序的 执行环境 (Execution Environment)，而它们的实现又依赖于操作系统提供的系统调用。</p>
</blockquote>
<ul>
<li>所以我们需要剥离标准库，才能在裸机上执行。操作系统则提供关于标准库的系统调用。</li>
</ul>
<h3 id="平台与目标三元组">平台与目标三元组</h3>
<blockquote>
<p>编译器在编译、链接得到可执行文件时需要知道，程序要在哪个 平台 (Platform) 上运行， 目标三元组 (Target Triplet) 描述了目标平台的 CPU 指令集、操作系统类型和标准运行时库。</p>
</blockquote>
<blockquote>
<p>我们研究一下现在 Hello, world! 程序的目标三元组是什么：</p>
</blockquote>
<ul>
<li>在我的环境下：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ rustc --verbose --version
</span></span><span style="display:flex;"><span>rustc 1.77.2 <span style="color:#ff79c6">(</span>25ef9e3d8 2024-04-09<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>binary: rustc
</span></span><span style="display:flex;"><span>commit-hash: 25ef9e3d85d934b27d9dada2f9dd52b1dc63bb04
</span></span><span style="display:flex;"><span>commit-date: 2024-04-09
</span></span><span style="display:flex;"><span>host: x86_64-unknown-linux-gnu
</span></span><span style="display:flex;"><span>release: 1.77.2
</span></span><span style="display:flex;"><span>LLVM version: 17.0.6
</span></span></code></pre></div><ul>
<li>也就是 x86_64 (amd64)、Linux、GNU glibc。</li>
</ul>
<blockquote>
<p>接下来，我们希望把 Hello, world! 移植到 RICV 目标平台 riscv64gc-unknown-none-elf 上运行。</p>
</blockquote>
<ul>
<li>注意，接下来没有标准库可供调用。</li>
</ul>
<h3 id="修改目标平台">修改目标平台</h3>
<blockquote>
<p>将程序的目标平台换成 riscv64gc-unknown-none-elf，试试看会发生什么：</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ cargo run --target riscv64gc-unknown-none-elf
</span></span><span style="display:flex;"><span>   Compiling os v0.1.0 <span style="color:#ff79c6">(</span>/home/ezra/rCore-Tutorial-Code-2024S/os<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>error<span style="color:#ff79c6">[</span>E0463<span style="color:#ff79c6">]</span>: can&#39;t find crate <span style="color:#ff79c6">for</span> <span style="color:#f1fa8c">`</span>std<span style="color:#f1fa8c">`</span>
</span></span><span style="display:flex;"><span>  |
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">=</span> note: the <span style="color:#f1fa8c">`</span>riscv64gc-unknown-none-elf<span style="color:#f1fa8c">`</span> target may not be <span style="color:#8be9fd;font-style:italic">installed</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">=</span> help: consider downloading the target with <span style="color:#f1fa8c">`</span>rustup target add riscv64gc-unknown-none-elf<span style="color:#f1fa8c">`</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>error: cannot find macro <span style="color:#f1fa8c">`</span>println<span style="color:#f1fa8c">`</span> in this scope
</span></span><span style="display:flex;"><span> --&gt; src/main.rs:2:5
</span></span><span style="display:flex;"><span>  |
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">2</span> |     println!<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Hello, world!&#34;</span><span style="color:#ff79c6">)</span>;
</span></span><span style="display:flex;"><span>  |     ^^^^^^^
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>error: requires <span style="color:#f1fa8c">`</span>sized<span style="color:#f1fa8c">`</span> lang_item
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>For more information about this error, try <span style="color:#f1fa8c">`</span>rustc --explain E0463<span style="color:#f1fa8c">`</span>.
</span></span><span style="display:flex;"><span>error: could not compile <span style="color:#f1fa8c">`</span>os<span style="color:#f1fa8c">`</span> <span style="color:#ff79c6">(</span>bin <span style="color:#f1fa8c">&#34;os&#34;</span><span style="color:#ff79c6">)</span> due to <span style="color:#bd93f9">3</span> previous errors
</span></span></code></pre></div><blockquote>
<p>报错的原因是目标平台上确实没有 Rust 标准库 std，也不存在任何受 OS 支持的系统调用。 这样的平台被我们称为 裸机平台 (bare-metal)。</p>
</blockquote>
<blockquote>
<p>幸运的是，除了 std 之外，Rust 还有一个不需要任何操作系统支持的核心库 core， 它包含了 Rust 语言相当一部分核心机制，可以满足本门课程的需求。 有很多第三方库也不依赖标准库 std，而仅仅依赖核心库 core。</p>
</blockquote>
<blockquote>
<p>为了以裸机平台为目标编译程序，我们要将对标准库 std 的引用换成核心库 core。</p>
</blockquote>
<h2 id="移除标准库依赖">移除标准库依赖</h2>
<ul>
<li>编辑 os/.cargo/config 文件，加入以下内容：</li>
</ul>
<pre tabindex="0"><code class="language-conf" data-lang="conf">[build]
target = &#34;riscv64gc-unknown-none-elf&#34;
</code></pre><ul>
<li>这将会持久化设定目标平台的设定为 riscv64gc。</li>
</ul>
<blockquote>
<p>这将使 cargo 工具在 os 目录下默认会使用 riscv64gc-unknown-none-elf 作为目标平台。 这种编译器运行的平台（x86_64）与可执行文件运行的目标平台不同的情况，称为 交叉编译 (Cross Compile)。</p>
</blockquote>
<h3 id="移除-println-宏">移除 println! 宏</h3>
<blockquote>
<p>我们在 main.rs 的开头加上一行 #![no_std]， 告诉 Rust 编译器不使用 Rust 标准库 std 转而使用核心库 core。重新编译，报错如下：</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ cargo run
</span></span><span style="display:flex;"><span>   Compiling os v0.1.0 <span style="color:#ff79c6">(</span>/home/ezra/rCore-Tutorial-Code-2024S/os<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>error<span style="color:#ff79c6">[</span>E0463<span style="color:#ff79c6">]</span>: can<span style="color:#f1fa8c">&#39;t find crate for `core`
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">  |
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">  = note: the `riscv64gc-unknown-none-elf` target may not be installed
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">  = help: consider downloading the target with `rustup target add riscv64gc-unknown-none-elf`
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">error[E0463]: can&#39;</span>t find crate <span style="color:#ff79c6">for</span> <span style="color:#f1fa8c">`</span>compiler_builtins<span style="color:#f1fa8c">`</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>error: cannot find macro <span style="color:#f1fa8c">`</span>println<span style="color:#f1fa8c">`</span> in this scope
</span></span><span style="display:flex;"><span> --&gt; src/main.rs:3:5
</span></span><span style="display:flex;"><span>  |
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">3</span> |     println!<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Hello, world!&#34;</span><span style="color:#ff79c6">)</span>;
</span></span><span style="display:flex;"><span>  |     ^^^^^^^
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>error: requires <span style="color:#f1fa8c">`</span>sized<span style="color:#f1fa8c">`</span> lang_item
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>For more information about this error, try <span style="color:#f1fa8c">`</span>rustc --explain E0463<span style="color:#f1fa8c">`</span>.
</span></span><span style="display:flex;"><span>error: could not compile <span style="color:#f1fa8c">`</span>os<span style="color:#f1fa8c">`</span> <span style="color:#ff79c6">(</span>bin <span style="color:#f1fa8c">&#34;os&#34;</span><span style="color:#ff79c6">)</span> due to <span style="color:#bd93f9">4</span> previous errors
</span></span></code></pre></div><ul>
<li>注意到环境配置似乎有些问题，没有安装 riscv64gc-unknown-none-elf 的 target。解决方案如下：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ rustup target add riscv64gc-unknown-none-elf
</span></span></code></pre></div><blockquote>
<p>println! 宏是由标准库 std 提供的，且会使用到一个名为 write 的系统调用。 无论如何，我们先将这行代码注释掉。</p>
</blockquote>
<h3 id="提供语义项-panic_handler">提供语义项 panic_handler</h3>
<blockquote>
<p>标准库 std 提供了 Rust 错误处理函数 #[panic_handler]，其大致功能是打印出错位置和原因并杀死当前应用。 但核心库 core 并没有提供这项功能，得靠我们自己实现。</p>
</blockquote>
<ul>
<li>例子：移除了 println! 后，依然存在以下错误。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ cargo run
</span></span><span style="display:flex;"><span>   Compiling os v0.1.0 <span style="color:#ff79c6">(</span>/home/ezra/rCore-Tutorial-Code-2024S/os<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>error: <span style="color:#f1fa8c">`</span><span style="color:#6272a4">#[panic_handler]` function required, but not found</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>error: could not compile <span style="color:#f1fa8c">`</span>os<span style="color:#f1fa8c">`</span> <span style="color:#ff79c6">(</span>bin <span style="color:#f1fa8c">&#34;os&#34;</span><span style="color:#ff79c6">)</span> due to <span style="color:#bd93f9">1</span> previous error
</span></span></code></pre></div><blockquote>
<p>新建一个子模块 os/src/lang_items.rs，在里面编写 panic 处理函数，通过标记 #[panic_handler] 告知编译器采用我们的实现：</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#ff79c6">use</span> core::panic::PanicInfo;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">#[panic_handler]</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">fn</span> <span style="color:#50fa7b">panic</span>(_info: <span style="color:#ff79c6">&amp;</span><span style="color:#50fa7b">PanicInfo</span>) -&gt; <span style="color:#ff79c6">!</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">loop</span> {}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>不要忘了在 main.rs 里引用你写的 panic。 <code>mod lang_items;</code> 即可。</li>
</ul>
<h3 id="移除-main-函数">移除 main 函数</h3>
<ul>
<li>接下来重新编译，提示在入口点又出现了问题。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ cargo run
</span></span><span style="display:flex;"><span>   Compiling os v0.1.0 <span style="color:#ff79c6">(</span>/home/ezra/rCore-Tutorial-Code-2024S/os<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>error: using <span style="color:#f1fa8c">`</span>fn main<span style="color:#f1fa8c">`</span> requires the standard library
</span></span><span style="display:flex;"><span>  |
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">=</span> help: use <span style="color:#f1fa8c">`</span><span style="color:#6272a4">#![no_main]` to bypass the Rust generated entrypoint and declare a platform specific entrypoint yourself, usually with `#[no_mangle]`</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>error: could not compile <span style="color:#f1fa8c">`</span>os<span style="color:#f1fa8c">`</span> <span style="color:#ff79c6">(</span>bin <span style="color:#f1fa8c">&#34;os&#34;</span><span style="color:#ff79c6">)</span> due to <span style="color:#bd93f9">1</span> previous error
</span></span></code></pre></div><ul>
<li>如编译器所说，我们在 main.rs 中加入 <code>#![no_main]</code> 即可。</li>
</ul>
<blockquote>
<p>至此，我们终于移除了所有标准库依赖。</p>
</blockquote>
<ul>
<li>不过直接执行它是行不通的。不要忘记你使用的是 x86_64 的机器。</li>
<li>错误信息如下。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ cargo run
</span></span><span style="display:flex;"><span>   Compiling os v0.1.0 <span style="color:#ff79c6">(</span>/home/ezra/rCore-Tutorial-Code-2024S/os<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>warning: <span style="color:#ff79c6">function</span> <span style="color:#f1fa8c">`</span>main<span style="color:#f1fa8c">`</span> is never used
</span></span><span style="display:flex;"><span> --&gt; src/main.rs:4:4
</span></span><span style="display:flex;"><span>  |
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">4</span> | fn main<span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>  |    ^^^^
</span></span><span style="display:flex;"><span>  |
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">=</span> note: <span style="color:#f1fa8c">`</span><span style="color:#6272a4">#[warn(dead_code)]` on by default</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>warning: <span style="color:#f1fa8c">`</span>os<span style="color:#f1fa8c">`</span> <span style="color:#ff79c6">(</span>bin <span style="color:#f1fa8c">&#34;os&#34;</span><span style="color:#ff79c6">)</span> generated <span style="color:#bd93f9">1</span> warning
</span></span><span style="display:flex;"><span>    Finished dev <span style="color:#ff79c6">[</span>unoptimized + debuginfo<span style="color:#ff79c6">]</span> target<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span> in 0.27s
</span></span><span style="display:flex;"><span>     Running <span style="color:#f1fa8c">`</span>target/riscv64gc-unknown-none-elf/debug/os<span style="color:#f1fa8c">`</span>
</span></span><span style="display:flex;"><span>target/riscv64gc-unknown-none-elf/debug/os: 1: ELF�@�@8@
</span></span><span style="display:flex;"><span>                                                        : not found
</span></span><span style="display:flex;"><span>target/riscv64gc-unknown-none-elf/debug/os: 2: Syntax error: <span style="color:#f1fa8c">&#34;(&#34;</span> unexpected
</span></span></code></pre></div><h3 id="分析被移除标准库的程序">分析被移除标准库的程序</h3>
<blockquote>
<p>我们可以通过一些工具来分析目前的程序：</p>
</blockquote>
<ul>
<li>file 获取简略的文件类型信息。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ file target/riscv64gc-unknown-none-elf/debug/os
</span></span><span style="display:flex;"><span>target/riscv64gc-unknown-none-elf/debug/os: ELF 64-bit LSB executable, UCB RISC-V, RVC, double-float ABI, version <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">(</span>SYSV<span style="color:#ff79c6">)</span>, statically linked, with debug_info, not stripped
</span></span></code></pre></div><ul>
<li>rust-readbj 读取详细符号信息。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ rust-readobj -h target/riscv64gc-unknown-none-elf/debug/os
</span></span><span style="display:flex;"><span>Could not find tool: readobj
</span></span><span style="display:flex;"><span>at: /home/ezra/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/bin/llvm-readobj
</span></span><span style="display:flex;"><span>Consider <span style="color:#f1fa8c">`</span>rustup component add llvm-tools-preview
</span></span></code></pre></div><ul>
<li>哎哟忘记装了，按提示装一下吧。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ rustup component add llvm-tools-preview
</span></span><span style="display:flex;"><span>info: downloading component <span style="color:#f1fa8c">&#39;llvm-tools&#39;</span>
</span></span><span style="display:flex;"><span>info: installing component <span style="color:#f1fa8c">&#39;llvm-tools&#39;</span>
</span></span><span style="display:flex;"><span> 29.6 MiB /  29.6 MiB <span style="color:#ff79c6">(</span><span style="color:#bd93f9">100</span> %<span style="color:#ff79c6">)</span>  11.3 MiB/s in  2s ETA:  0s
</span></span></code></pre></div><ul>
<li>装好以后可以读取出以下符号信息。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ rust-readobj -h target/riscv64gc-unknown-none-elf/debug/os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>File: target/riscv64gc-unknown-none-elf/debug/os
</span></span><span style="display:flex;"><span>Format: elf64-littleriscv
</span></span><span style="display:flex;"><span>Arch: riscv64
</span></span><span style="display:flex;"><span>AddressSize: 64bit
</span></span><span style="display:flex;"><span>LoadName: &lt;Not found&gt;
</span></span><span style="display:flex;"><span>ElfHeader <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>  Ident <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    Magic: <span style="color:#ff79c6">(</span>7F <span style="color:#bd93f9">45</span> 4C 46<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    Class: 64-bit <span style="color:#ff79c6">(</span>0x2<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    DataEncoding: LittleEndian <span style="color:#ff79c6">(</span>0x1<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    FileVersion: <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>    OS/ABI: SystemV <span style="color:#ff79c6">(</span>0x0<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    ABIVersion: <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>    Unused: <span style="color:#ff79c6">(</span><span style="color:#bd93f9">00</span> <span style="color:#bd93f9">00</span> <span style="color:#bd93f9">00</span> <span style="color:#bd93f9">00</span> <span style="color:#bd93f9">00</span> <span style="color:#bd93f9">00</span> 00<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>  Type: Executable <span style="color:#ff79c6">(</span>0x2<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  Machine: EM_RISCV <span style="color:#ff79c6">(</span>0xF3<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  Version: <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>  Entry: 0x0
</span></span><span style="display:flex;"><span>  ProgramHeaderOffset: 0x40
</span></span><span style="display:flex;"><span>  SectionHeaderOffset: 0x1788
</span></span><span style="display:flex;"><span>  Flags <span style="color:#ff79c6">[</span> <span style="color:#ff79c6">(</span>0x5<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    EF_RISCV_FLOAT_ABI_DOUBLE <span style="color:#ff79c6">(</span>0x4<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    EF_RISCV_RVC <span style="color:#ff79c6">(</span>0x1<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>  HeaderSize: <span style="color:#bd93f9">64</span>
</span></span><span style="display:flex;"><span>  ProgramHeaderEntrySize: <span style="color:#bd93f9">56</span>
</span></span><span style="display:flex;"><span>  ProgramHeaderCount: <span style="color:#bd93f9">4</span>
</span></span><span style="display:flex;"><span>  SectionHeaderEntrySize: <span style="color:#bd93f9">64</span>
</span></span><span style="display:flex;"><span>  SectionHeaderCount: <span style="color:#bd93f9">12</span>
</span></span><span style="display:flex;"><span>  StringTableSectionIndex: <span style="color:#bd93f9">10</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><ul>
<li>反汇编导出汇编程序信息。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ rust-objdump -S target/riscv64gc-unknown-none-elf/debug/os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>target/riscv64gc-unknown-none-elf/debug/os:     file format elf64-littleriscv
</span></span></code></pre></div><blockquote>
<p>通过 file 工具对二进制程序 os 的分析可以看到，它好像是一个合法的 RV64 执行程序， 但 rust-readobj 工具告诉我们它的入口地址 Entry 是 0。 再通过 rust-objdump 工具把它反汇编，没有生成任何汇编代码。 可见，这个二进制程序虽然合法，但它是一个空程序，原因是缺少了编译器规定的入口函数 _start 。</p>
</blockquote>
<blockquote>
<p>从下一节开始，我们将着手实现本节移除的、由用户态执行环境提供的功能。</p>
</blockquote>

    </article>
  </div>

</div>


  
<script type="text/javascript" src="/main.js" defer></script>


<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-PROPERTY_ID', 'auto');
	
	ga('send', 'pageview');
}
</script>
</body>

</html>